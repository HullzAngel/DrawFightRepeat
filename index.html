<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Narrative Challenge Deck</title>
  <style>

    @font-face {
      font-family: 'OSRSFont';
      src: url('fonts/osrs.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }
    
    body {
      margin: 0;
      font-family: 'OSRSFont';
      background: #1c1c1c;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    h1 {
      margin-bottom: 0px;
      font-size: 7rem;
      color: #f5c242;
      text-shadow: 1px 1px 4px #000;
    }

    .deck-container {
      display: flex;
      gap: 20px;
      perspective: 1000px;
      margin-bottom: 0px;
    }

    .card {
      width: 200px;
      height: 280px;
      background: #333;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      text-align: center;
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
      transition: transform 0.6s;
      transform-style: preserve-3d;
      position: relative;
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0px;
      background-size: 100% 100%;
      background-position: top left; 
      background-repeat: no-repeat;
    }

    .card-face .card-text {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      text-align: center;
      color: inherit;
      font-size: inherit;
      pointer-events: none;
    }

    .card-back .card-text {
      position: absolute;
      top: 70%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      text-align: center;
      color: #000000;
      font-size: 1rem;
      pointer-events: none;
    }

    .card-front {
      background: #444;
      color: #f5f5f5;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .card-back {
      background: #222;
      color: #000000;
      transform: rotateY(180deg);
      font-size: 1rem;
    }

    .haunted-glow {
      box-shadow: 0 0 20px 5px #ff00ff inset, 0 0 20px 5px #ff00ff;
      border: 0px solid #ff00ff;
    }

    .mystical-text {
      font-style: italic;
      text-align: center;
      color: #ffffff; /* base color */
      font-size: 1.6rem; /* or 20px, 24px, etc. */
      margin-bottom: 60px;

    }
    .deck-message {
      font-family: 'OSRSFont', Arial, sans-serif; /* match page font */
      font-size: 2rem;
      color: #ffffff;
      text-align: center;
      margin-top: 40px;
      margin-bottom: 60px;
    }

    button {
      font-family: 'OSRSFont';
      padding: 12px 24px;
      font-size: 24px;
      border: none;
      border-radius: 8px;
      background: #f5c242;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      margin: 5px;
    }

    button:hover {
      background: #ffffff;
      color: #f5c242;
    }

    @keyframes shuffle {
      0%   { transform: translateX(0) rotate(0deg); z-index: 1; }
      25%  { transform: translateX(-100px) rotate(-15deg); z-index: 2; }
      50%  { transform: translateX(100px) rotate(15deg); z-index: 2; }
      75%  { transform: translateX(-50px) rotate(-10deg); z-index: 2; }
      100% { transform: translateX(0) rotate(0deg); z-index: 1; }
    }

    .card.shuffling {
      animation: shuffle 0.6s ease-in-out;
    }

    .deck-container.disabled {
      pointer-events: none;
      }
  </style>
</head>
<body>
  <h1>Draw. Fight. Repeat.</h1>
  <p class="mystical-text">Each time you draw, destiny twists. Should effects clash, your last card insists.</p>
  <div class="deck-container" id="deckContainer"></div>
  <p class="deck-message">Click a card to reveal it...</p>
  <div>
    <button onclick="shuffleDeck()">Shuffle Deck</button>
  </div>

  <script>
    const cards = [
      "Staff bashes only.", //THE MONK
      "No armour, only high-damage weapons.", //THE BERSERKER
      "Only use items you pick up during the challenge.", //THE SCAVENGER
      "Every time you eat, drop a random item.", //THE CURSED ONE
      "Must wear full metal armour. Never retreat.", //THE KNIGHT
      "Always use the strongest weapon in your inventory.", //THE ASSASSIN
      "Only combat spells allowed.", //THE WARLOCK
      "Max damage gear but no food allowed.", //THE GLASS CANNON
      "Re-flip this slot every 10 minutes.", //THE HAUNTED
      "Wear at least one ridiculous cosmetic item while fighting.", //THE JESTER
      "You may only fight monsters 1:1 — no multi-combat zones.", //THE DUELIST
      "You must finish each kill with a ranged or thrown weapon.", //THE HUNTER
      "No magic, no ranged — melee only.", //THE SILENCE
      "You can only heal using lifesteal effects.", //THE VAMPIRE
      "No banking until the task is done.", //THE BANKER
      "You can only eat food that you cook or gather yourself during the run.", //THE FORAGER
      "You must keep every item you come across — no dropping allowed.", //THE HOARDER
      "Spend no more than 1,000 coins on supplies.", //THE BEGGAR
      "If you wish, you can reshuffle this hand and redraw.", //THE GAMBLER
      "You must drink in-game alcohol after every kill.", //THE DRUNKARD
      "You must travel on foot only. No teleports.", //THE PILGRIM
      "Every kill, you must swap to a new weapon.", //THE SWITCHEROO
      "Your most valuable drop goes to your opponent at the end.", //THE UNLUCKY ONE
      "Regularly message your opponent compliments.", //THE LOVER
      "You must always eat up to max health.", //THE GLUTTON
      "You cannot heal above 50% health.", //THE FRAGILE
      "You must equip a light source all the time.", //THE MOTH
      "Monsters must attack you first.", //THE PACIFIST
      "You cannot pickup monster drops", //THE BLIND
      "Use the opposite combat style to a monster's weakness", //THE REVERSER
      "You cannot return to a place you've been.", //THE NOMAD
      "Copy the attack style of the monster you're fighting", //THE MIMIC
      "You must emote at the end of every kill", //THE EMOTER
      "1hp. Full Dharok. You know the drill.", //THE DHAROKER
      "All your loot is doubled.", //THE HEIST
      "You can ignore one of the other cards.", //THE SAGE
      "You may extend your timer by 10 minutes.", //THE TIMEKEEPER
      "You can force your opponent to swap one of their cards with yours.", //THE TRICKSTER
      "You must reveal all cards and respect their effects.", //THE JOKER
      "Your opponent cannot use the wiki.", //THE SCOUT
      "Any budget restrictions are removed.", //THE MERCHANT
      "Your opponent must give you their most valuable drop at the end.", //THE LUCKY ONE
      "You may declare one combat style that your opponent cannot use.", //THE CHOSEN
      "You must always be under the effect of a potion.", //THE CHEMIST
      "Always walk. Never run.", //THE SLUG
      "Wear at least one god aligned item.", //THE FANATIC
      "Always wear a chefs hat. And an apron.", //THE COOK
      "You can only kill monsters in dungeons.", //THE DELVER
      "Always eat food two at a time.", //THE MCDOUBLE
      "If you get hit for more than 15, type "ouch".", //THE LARPER
      "On a killing blow, you must be facing north.", //THE COMPASS
      "Your gear must weigh over 30kg.", //THE HEAVYWEIGHT
      "Your gear must weight under 15kg.", //THE LIGHTWEIGHT
      "Only use degradable armour and weapons.", //THE ANTIQUE
      "Only fight monsters below your combat level.", //THE BULLY
      "Only fight monsters above your combat level.", //THE GOLIATH
      "No overhead prayers.", //THE FAITHLESS
      "No potions allowed.", //THE COLD TURKEY
      "No gear from the same set allowed.", //THE PATCHWORK
      "You're locked to The Wilderness.", //THE OUTLAW
      "Only finish kills with a special attack.", //THE SHOWMAN
      "No quick prayers.", //THE MANUAL
      "You can only use equipment with dragon in the name.", //THE DRAGONBORN
      "Wear bronze platelegs.", //THE CRIPPLED
      "Only food allowed is gnome food.", //THE GNOME
      "You're locked to Morytania." //THE SETTLED
    ];

    const cardFrontImages = {
      0: 'images/monk.png', 
      1: 'images/berserker.png', 
      2: 'images/scavenger.png',
      3: 'images/cursed.png', 
      4: 'images/knight.png', 
      5: 'images/assassin.png',
      6: 'images/warlock.png', 
      7: 'images/glasscannon.png', 
      8: 'images/haunted.png',
      9: 'images/jester.png', 
      10: 'images/duelist.png', 
      11: 'images/hunter.png',
      12: 'images/silence.png', 
      13: 'images/vampire.png', 
      14: 'images/banker.png',
      15: 'images/forager.png', 
      16: 'images/hoarder.png', 
      17: 'images/beggar.png',
      18: 'images/gambler.png', 
      19: 'images/drunkard.png', 
      20: 'images/pilgrim.png',
      21: 'images/switcheroo.png', 
      22: 'images/unlucky.png',
      23: 'images/lover.png',
      24: 'images/glutton.png',
      25: 'images/fragile.png',
      26: 'images/moth.png',
      27: 'images/pacifist.png',
      28: 'images/blind.png',
      29: 'images/reverser.png',
      30: 'images/nomad.png',
      31: 'images/mimic.png',
      32: 'images/emoter.png',
      33: 'images/dharoker.png',
      34: 'images/heist.png',
      35: 'images/sage.png',
      36: 'images/timekeeper.png',
      37: 'images/trickster.png',
      38: 'images/joker.png',
      39: 'images/scout.png',
      40: 'images/merchant.png',
      41: 'images/luckyone.png',
      42: 'images/chosen.png',
      43: 'images/chosen.png',
      44: 'images/chosen.png',
      45: 'images/chosen.png',
      46: 'images/chosen.png',
      47: 'images/chosen.png',
      48: 'images/chosen.png',
      49: 'images/chosen.png',
      50: 'images/chosen.png',
      51: 'images/chosen.png',
      52: 'images/chosen.png',
      53: 'images/chosen.png',
      54: 'images/chosen.png',
      55: 'images/chosen.png',
      56: 'images/chosen.png',
      57: 'images/chosen.png',
      58: 'images/chosen.png',
      59: 'images/chosen.png',
      60: 'images/chosen.png',
      61: 'images/chosen.png',
      62: 'images/chosen.png',
      63: 'images/chosen.png',
      64: 'images/chosen.png',
      65: 'images/chosen.png'
    };

    const deckContainer = document.getElementById('deckContainer');
    let currentDeck = [];

    const cardBackImage = 'images/back.png';

    function createCardElement(cardValue, slotIndex) {
      const cardEl = document.createElement('div');
      cardEl.className = 'card';
      cardEl.dataset.hauntedLocked = "false"; // NEW: lock flag

      // FRONT
      const front = document.createElement('div');
      front.className = 'card-face card-front';
      front.style.backgroundImage = `url('${cardBackImage}')`;
      const frontText = document.createElement('div');
      frontText.className = 'card-text';
      //frontText.textContent = "Click to reveal";
      front.appendChild(frontText);

      // BACK
      const back = document.createElement('div');
      back.className = 'card-face card-back';
      const cardIndex = cards.indexOf(cardValue);
      if (cardFrontImages[cardIndex] !== undefined) {
        back.style.backgroundImage = `url('${cardFrontImages[cardIndex]}')`;
      }
      const backText = document.createElement('div');
      backText.className = 'card-text';
      backText.textContent = cardValue;
      back.appendChild(backText);

      // Haunted badge
      const hauntedBadge = document.createElement('div');
      hauntedBadge.style.position = 'absolute';
      hauntedBadge.style.top = '5px';
      hauntedBadge.style.right = '5px';
      hauntedBadge.style.width = '20px';
      hauntedBadge.style.height = '20px';
      hauntedBadge.style.borderRadius = '50%';
      hauntedBadge.style.background = '#ff00ff';
      hauntedBadge.style.display = 'none';
      cardEl.appendChild(hauntedBadge);

      cardEl.appendChild(front);
      cardEl.appendChild(back);

      // CLICK HANDLER
      cardEl.addEventListener('click', () => {
        if (!cardEl.classList.contains('flipped')) {
          cardEl.classList.add('flipped');

          if (cardValue.includes("The Haunted") || cardValue.includes("Re-flip this slot")) {
            hauntedBadge.style.display = "block";
            cardEl.classList.add('haunted-glow');
            cardEl.dataset.haunted = "true"; // mark as Haunted revealed
            if (cardValue.includes("The Haunted")) {
              cardEl.dataset.hauntedLocked = "true"; // lock this slot
            }
          }

        } else {
          cardEl.classList.remove('flipped');

          if (hauntedBadge.style.display === "block") {
            setTimeout(() => {
              const faceUpCards = Array.from(deckContainer.querySelectorAll('.card.flipped .card-text')).map(el => el.textContent);

              const availableCards = cards.filter(c => 
                !faceUpCards.includes(c) && 
                !(cardEl.dataset.hauntedLocked === "true" && c.includes("The Haunted"))
              );

              if (availableCards.length === 0) return;

              let newCard;
              do {
                newCard = availableCards[Math.floor(Math.random() * availableCards.length)];
              } while (newCard === cardValue);

              cardValue = newCard;
              backText.textContent = cardValue;

              const newCardIndex = cards.indexOf(cardValue);
              if (cardFrontImages[newCardIndex] !== undefined) {
                back.style.backgroundImage = `url('${cardFrontImages[newCardIndex]}')`;
              }

              currentDeck[slotIndex] = cardValue;
            }, 600);
          }
        }
      });

      return cardEl;
    }

    function renderDeck(deckArray) {
      deckContainer.innerHTML = '';
      currentDeck = [...deckArray];
      deckArray.forEach((cardText, index) => {
        const cardEl = createCardElement(cardText, index);
        deckContainer.appendChild(cardEl);
      });
    }

    function shuffleDeck() {
      const shuffled = [...cards].sort(() => Math.random() - 0.5);
      const selected = shuffled.slice(0, 5);

      const cardElements = document.querySelectorAll('.card');

      if (cardElements.length === 0) {
        renderDeck(selected);
        return;
      }

      // Disable clicks during shuffle
      deckContainer.classList.add('disabled');

      // Force all cards back face-down
      cardElements.forEach(card => {
        card.classList.remove('flipped');
      });

      // Animate each card
      cardElements.forEach((card, i) => {
        setTimeout(() => {
          card.classList.add('shuffling');
          card.addEventListener('animationend', () => {
            card.classList.remove('shuffling');

            if (i === cardElements.length - 1) {
              renderDeck(selected);
              // Re-enable clicks after new deck is rendered
              deckContainer.classList.remove('disabled');
            }
          }, { once: true });
        }, i * 150);
      });
    }


    shuffleDeck();
  </script>
</body>
</html>




